[build]
publish = "outreach/website"
command = """
    # Create necessary directories
    mkdir -p outreach/website/documents outreach/website/download
    
    # Copy documentation
    cp -f docs/Spielbeschreibungen/*.pdf outreach/website/documents/ || echo "Warning: PDF files not copied"
    
    # Check Java version
    java -version
    
    # Build the JAR file using Gradle
    ./gradlew jar --stacktrace --info

    # Check if JAR was built successfully
    if [ -f "build/libs/settlersOfAsgard.jar" ]; then
        echo "JAR built successfully!"
        cp -f build/libs/settlersOfAsgard.jar outreach/website/download/SettlersOfAsgard.jar
    else
        echo "JAR build failed, creating fallback placeholder"
        # Create a placeholder with a message inside
        echo "This is a placeholder JAR. Please visit our GitHub repository for the full game." > outreach/website/download/SettlersOfAsgard.jar
    fi
    
    # Verify that the website files exist
    ls -la outreach/website/
    ls -la outreach/website/download/
    ls -la outreach/website/documents/
"""

[build.environment]
  # Set Java version to 17
  JAVA_VERSION = "17"
  NODE_VERSION = "16"
  # Set Gradle options
  GRADLE_OPTS = "-Dorg.gradle.daemon=false -Dorg.gradle.parallel=true"

# This redirect ensures any path will serve index.html
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200

[[headers]]
  for = "/images/*"
  [headers.values]
    Cache-Control = "public, max-age=604800"

[[headers]]
  for = "/download/*"
  [headers.values]
    Cache-Control = "public, max-age=86400"
